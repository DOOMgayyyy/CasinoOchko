<?php

/**
 * Класс gameLogic - содержит игровую логику для игры Очко (Блэкджек)
 * Предоставляет статические методы для расчета очков руки,
 * проверки на блэкджек и определения перебора.
 * Реализует правила игры Очко с правильной обработкой тузов.
 */
class gameLogic {
    /**
     * Рассчитывает очки руки с учетом правил игры Очко
     * 
     * Основные правила расчета:
     * - Числовые карты (2-10) = их номинал
     * - Картинки (J, Q, K) = 10 очков
     * - Туз (A) = 11 или 1 (выбирается оптимальное значение)
     * 
     * Алгоритм обработки тузов:
     * 1. Сначала все тузы считаются как 11
     * 2. Если сумма > 21 и есть тузы, переводим их по одному в единицы
     * 3. Продолжаем до тех пор, пока сумма <= 21 или тузы не закончатся
     * 
     * @param array $cards Массив объектов Card
     * @return int Оптимальное количество очков для данной руки
     */
    public static function calculateHandScore(array $cards) {
        $score = 0;  # Общая сумма очков
        $aces = 0;   # Количество тузов в руке

        # Первый проход: подсчитываем базовые очки и количество тузов
        foreach ($cards as $card) {
            if ($card->rank === 'A') {
                $aces++;
                $score += 11; # Изначально туз считается как 11
            } else {
                $score += $card->value; # Добавляем базовое значение карты
            }
        }

        # Второй проход: оптимизируем значение тузов
        # Если сумма больше 21 и есть тузы, переводим их в единицы
        while ($score > 21 && $aces > 0) {
            $score -= 10; # Переводим туз с 11 на 1 (разница = 10)
            $aces--;      # Уменьшаем счетчик доступных для перевода тузов
        }

        return $score;
    }

    /**
     * Проверяет, является ли рука блэкджеком (натуральным 21)
     * 
     * Блэкджек - это комбинация из ровно 2 карт, дающая 21 очко.
     * Обычно это туз + карта стоимостью 10 очков (10, J, Q, K).
     * Блэкджек считается лучше обычного 21 из 3+ карт.
     * 
     * @param array $cards Массив объектов Card
     * @return bool true если рука является блэкджеком, false иначе
     */
    public static function isBlackjack(array $cards) {
        return count($cards) === 2 && self::calculateHandScore($cards) === 21;
    }

    /**
     * Проверяет, является ли рука перебором (больше 21 очка)
     * 
     * Перебор (bust) происходит, когда сумма очков руки превышает 21.
     * В этом случае игрок автоматически проигрывает,
     * независимо от карт дилера.
     * 
     * @param array $cards Массив объектов Card
     * @return bool true если рука является перебором, false иначе
     */
    public static function isBust(array $cards) {
        return self::calculateHandScore($cards) > 21;
    }
}